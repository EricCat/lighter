// Generated by CoffeeScript 1.4.0
(function() {

  module.exports = function(settings) {
    var blog, fs, user;
    if (process.env.NODE_ENV !== 'production') {
      fs = require('fs');
      blog = require(__dirname + '/blog')(settings);
      user = require(__dirname + '/user')(settings);
      return fs.readFile(__dirname + '/../bin/post.md', 'utf8', function(err, result) {
        var categories, category, content, post, posts, promise, _i, _j, _len, _len1, _ref, _ref1, _results;
        blog["delete"](function() {});
        posts = [];
        _ref = result.split('#post');
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          post = _ref[_i];
          if (post !== '') {
            content = post.split('#block');
            categories = [];
            _ref1 = content[3].split(' ');
            for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
              category = _ref1[_j];
              category = category.replace(/^\n*|\n*$/g, '');
              categories.push(category);
            }
            promise = blog.create({
              title: content[0],
              body: content[1],
              author: content[2],
              categories: categories
            });
            _results.push(promise.then(function(result) {
              if (result.id !== null) {
                return console.log(result.permaLink);
              }
            }));
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      });
    }
  };

}).call(this);
